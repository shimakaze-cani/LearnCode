## 第三章 ARM体系结构与汇编语言



ARM处理器中常使用的Load/Store指令的使用方法：

```
LDR R1,[R0]           将R0的值作为地址，将该地址上的数据保存到R1
STR R1,[R0]           将R0的值作为地址，将R1的值存储到这个内存地址
LDRB/STRB             每次读写一字节，LDR/STR默认每次读写4字节
LDM/STM               批量加载/存储指令，在一组寄存器和一片内存之间传输数据
SWP R1,R1,[R0]        将R1与R0中地址指向的内存单元中的数据进行交换
SWP R1,R2,[R0]        将[R0]存储到R1，将R2写入[R0]这个内存存储单元
```

经常使用的是`LDR/STR`、`LDM/STM`这两对指令

### 满栈和空栈的区别

如果堆栈指针SP总是指向栈顶元素，那么就是满栈  F

如果堆栈指针SP指向的是栈顶元素的下一个空闲的存储单元，那么就是空栈  E

每入栈一个元素，栈指针SP会往栈增长的方向移动一个存储单元，如果栈指针SP从高地址从低地址移动，那么就是递减栈 D 

如果栈指针SP从低地址往高地址移动，那么就是递增栈 A

一般ARM使用的是满递减堆栈 FD

```
STMFD SP!,{R0-R2,R14}             将R0，R1，R2，R14依次压入内存栈
```

STMFD会根据{}中的寄存器列表的顺序，从左到右依次压入堆栈

```
LDMFD SP!,{R0-R2,R14}             将内存栈中的数据依次弹出到R14，R2，R1，R0
```

R0先入栈 为高地址，R14最后入栈，为低地址，SP指向R14入栈的位置

出栈时SP先弹至R14，之后R2，R1，R0，栈中元素依次弹出R14、R2寄存器后，SP指向R1

同时ARM提供了PUSH和POP指令来入栈和出栈

```
PUSH {R0-R2,R14}                 将R0，R1，R2，R14依次压入内存栈
POP {R0-R2,R14}                  将内存栈中的数据依次弹出到R14，R2，R1，R0
```

### 3.2.2 数据传输指令

```
MOV {cond} {S} Rd, operand2
MVN {cond} {S} Rd, operand2
```

`{cond}`条件可选项，{S}用来表示是否影响CPSR寄存器的值

`MVN`指令用来将操作数`operand2`按位取反后传达进目标寄存器`Rd`，操作数`operand2`可以是一个立即数，也可以是一个寄存器

```
MOV R1, #1                      将立即数1传送到寄存器R1中
MOV R1, R0                      将寄存器R0中的值传入R1
MOV PC, LR                      子程序返回
MVN R0, #OxFF
MVN R0, R1
```

```
ADD							加法
ADC							带进位加法
SUB							减法
AND							逻辑与
ORR							逻辑或
EOR							异或
BIC							位清除指令
```

